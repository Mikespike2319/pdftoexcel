<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Compatibility Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 10px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Windows Compatibility Test</h1>
    
    <div class="test-section">
        <h2>System Information</h2>
        <div id="systemInfo"></div>
    </div>
    
    <div class="test-section">
        <h2>Browser Capabilities</h2>
        <div id="browserInfo"></div>
    </div>
    
    <div class="test-section">
        <h2>Library Tests</h2>
        <div id="libraryTests"></div>
        <button onclick="testLibraries()">Test Libraries</button>
    </div>
    
    <div class="test-section">
        <h2>File System Tests</h2>
        <div id="fileTests"></div>
        <button onclick="testFileSystem()">Test File System</button>
    </div>
    
    <div class="test-section">
        <h2>Worker Tests</h2>
        <div id="workerTests"></div>
        <button onclick="testWorkers()">Test Web Workers</button>
    </div>
    
    <script>
        const systemInfo = document.getElementById('systemInfo');
        const browserInfo = document.getElementById('browserInfo');
        const libraryTests = document.getElementById('libraryTests');
        const fileTests = document.getElementById('fileTests');
        const workerTests = document.getElementById('workerTests');
        
        function addStatus(container, message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            container.appendChild(div);
            console.log(message);
        }
        
        // System Information
        function displaySystemInfo() {
            const platform = navigator.platform;
            const userAgent = navigator.userAgent;
            const isWindows = platform.indexOf('Win') !== -1;
            const protocol = window.location.protocol;
            
            addStatus(systemInfo, `Platform: ${platform}`, isWindows ? 'success' : 'info');
            addStatus(systemInfo, `Protocol: ${protocol}`, protocol === 'file:' ? 'warning' : 'info');
            addStatus(systemInfo, `User Agent: ${userAgent.split(' ').pop()}`, 'info');
            addStatus(systemInfo, `Windows Detected: ${isWindows ? 'Yes' : 'No'}`, isWindows ? 'success' : 'info');
        }
        
        // Browser Capabilities
        function displayBrowserCapabilities() {
            const capabilities = {
                'File API': typeof File !== 'undefined',
                'Blob API': typeof Blob !== 'undefined',
                'FileReader': typeof FileReader !== 'undefined',
                'Web Workers': typeof Worker !== 'undefined',
                'ArrayBuffer': typeof ArrayBuffer !== 'undefined',
                'URL.createObjectURL': typeof URL !== 'undefined' && typeof URL.createObjectURL === 'function'
            };
            
            for (const [capability, available] of Object.entries(capabilities)) {
                addStatus(browserInfo, `${capability}: ${available ? '✓ Available' : '✗ Not Available'}`, 
                         available ? 'success' : 'error');
            }
        }
        
        // Library Tests
        function testLibraries() {
            libraryTests.innerHTML = '';
            addStatus(libraryTests, 'Testing library loading...', 'info');
            
            // Test PDF.js
            const pdfjsScript = document.createElement('script');
            pdfjsScript.src = 'pdf.min.js';
            pdfjsScript.onload = () => {
                addStatus(libraryTests, '✓ PDF.js loaded successfully', 'success');
                
                // Test SheetJS
                const xlsxScript = document.createElement('script');
                xlsxScript.src = 'xlsx.min.js';
                xlsxScript.onload = () => {
                    addStatus(libraryTests, '✓ SheetJS loaded successfully', 'success');
                    
                    // Test Excel functionality
                    try {
                        const workbook = XLSX.utils.book_new();
                        const worksheet = XLSX.utils.aoa_to_sheet([['Test', 'Data'], [1, 2]]);
                        XLSX.utils.book_append_sheet(workbook, worksheet, 'Test');
                        addStatus(libraryTests, '✓ Excel export functionality working', 'success');
                    } catch (error) {
                        addStatus(libraryTests, `✗ Excel export failed: ${error.message}`, 'error');
                    }
                };
                xlsxScript.onerror = () => {
                    addStatus(libraryTests, '✗ SheetJS loading failed', 'error');
                };
                document.head.appendChild(xlsxScript);
            };
            pdfjsScript.onerror = () => {
                addStatus(libraryTests, '✗ PDF.js loading failed', 'error');
            };
            document.head.appendChild(pdfjsScript);
        }
        
        // File System Tests
        function testFileSystem() {
            fileTests.innerHTML = '';
            addStatus(fileTests, 'Testing file system capabilities...', 'info');
            
            // Test Blob creation
            try {
                const blob = new Blob(['test'], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                addStatus(fileTests, '✓ Blob and URL.createObjectURL working', 'success');
                URL.revokeObjectURL(url);
            } catch (error) {
                addStatus(fileTests, `✗ Blob creation failed: ${error.message}`, 'error');
            }
            
            // Test file input
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.pdf';
            addStatus(fileTests, '✓ File input element created', 'success');
            
            // Test filename sanitization
            const testFilenames = [
                'normal.pdf',
                'file with spaces.pdf',
                'file<>:"/\\|?*.pdf',
                'file with special chars!@#$%^&*().pdf'
            ];
            
            testFilenames.forEach(filename => {
                const cleanName = filename.replace(/[<>:"/\\|?*]/g, '_');
                addStatus(fileTests, `Filename sanitization: "${filename}" → "${cleanName}"`, 'info');
            });
        }
        
        // Worker Tests
        function testWorkers() {
            workerTests.innerHTML = '';
            addStatus(workerTests, 'Testing Web Workers...', 'info');
            
            try {
                const workerCode = `
                    self.onmessage = function(e) {
                        self.postMessage({ type: 'success', message: 'Worker is working' });
                    };
                `;
                
                const blob = new Blob([workerCode], { type: 'application/javascript' });
                const workerUrl = URL.createObjectURL(blob);
                const worker = new Worker(workerUrl);
                
                worker.onmessage = function(e) {
                    if (e.data.type === 'success') {
                        addStatus(workerTests, '✓ Web Workers working correctly', 'success');
                    }
                    worker.terminate();
                    URL.revokeObjectURL(workerUrl);
                };
                
                worker.onerror = function(error) {
                    addStatus(workerTests, `✗ Worker error: ${error.message}`, 'error');
                    URL.revokeObjectURL(workerUrl);
                };
                
                worker.postMessage({ test: true });
                
            } catch (error) {
                addStatus(workerTests, `✗ Worker creation failed: ${error.message}`, 'error');
            }
        }
        
        // Auto-run tests on load
        window.addEventListener('load', () => {
            displaySystemInfo();
            displayBrowserCapabilities();
        });
    </script>
</body>
</html>
